/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * To learn more about Gradle by exploring our Samples at https://docs.gradle.org/8.8/samples
 */
plugins {
    id 'base'
}

task installDependencies(type: Exec) {
    description = 'Install Python dependencies'
    commandLine 'pip3', 'install', '-r', 'requirements.txt'
}

task setupService(type: Exec) {
    description = 'Set up systemd service'
    doLast {
        def serviceFile = file('tic-tac-toe.service')
        serviceFile.text = """
        [Unit]
        Description=Tic Tac Toe Flask Application
        After=network.target

        [Service]
        User=root
        Group=root
        WorkingDirectory=${projectDir}
        ExecStart=/usr/bin/python3 ${projectDir}/app.py
        Restart=always

        [Install]
        WantedBy=multi-user.target
        """
        commandLine 'mv', serviceFile.absolutePath, '/etc/systemd/system/tic-tac-toe.service'
        commandLine 'systemctl', 'daemon-reload'
        commandLine 'systemctl', 'enable', 'tic-tac-toe.service'
        commandLine 'systemctl', 'start', 'tic-tac-toe.service'
    }
}

task install {
    dependsOn installDependencies, setupService
}

